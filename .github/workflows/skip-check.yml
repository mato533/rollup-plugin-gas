name: Check whether to skip processing
on:
  workflow_call:
    outputs:
      is-skip:
        description: "Must be skipped the process (return 1)"
        value: ${{ jobs.check-commit-msg.outputs.is-skip }}

jobs:
  check-commit-msg:
    name: Skip check
    runs-on: ubuntu-latest
    outputs:
      is-skip: ${{ steps.result.outputs.is-skip }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          fetch-depth: 1

      - name: Check wip
        id: check-wip
        run: |
          VAR_NAME="is-wip"
          commit_msg="$(git show ${{ github.event.pull_request.head.sha }} -s --format=%B)"
          msg="$(echo "${commit_msg}"|head -n 1|grep 'wip:' |wc -l )"
          RESULT="${VAR_NAME}=${msg}"
          echo "${RESULT}">>"${GITHUB_OUTPUT}"
          echo "${RESULT}"

      - name: Check auto generated commit
        id: check-auto-commit
        run: |
          VAR_NAME="is-auto"
          commit_msg="$(git show ${{ github.event.pull_request.head.sha }} -s --format=%B)"
          msg="$(echo "${commit_msg}"|grep "\[AUTO\]"| wc -l )"
          RESULT="${VAR_NAME}=${msg}"
          echo "${RESULT}">>"${GITHUB_OUTPUT}"
          echo "${RESULT}"

      - name: Set job output
        id: result
        env:
          IS_WIP: ${{ steps.check-wip.outputs.is-wip }}
          IS_AUTO: ${{ steps.check-auto-commit.outputs.is-auto }}
        run: |
          VAR_NAME="is-skip"
          if [ ${IS_WIP} == 0 ] && [ ${IS_AUTO} == 0 ];then
            RESULT="${VAR_NAME}=0"
          else
            RESULT="${VAR_NAME}=1"
          fi
          echo "${RESULT}">>"${GITHUB_OUTPUT}"
          echo "${RESULT}"
